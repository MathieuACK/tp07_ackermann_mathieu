import{$ as De,A as D,B as Ce,C as R,D as G,E as j,F as ae,G as se,H as xe,I as Y,J as Ee,K as Me,L as ke,M as Te,N as X,O as be,P as we,Q as Oe,R as le,S as F,T as Ie,U as Pe,V as Ae,W as Ne,X as Le,Y as ce,Z as T,_ as E,a as K,aa as Re,b as he,ba as J,c as g,ca as Ge,d as ie,da as je,e as re,ea as Fe,f as O,fa as Ue,g as I,ga as We,h as k,ha as Ve,i as _e,ia as ze,j as y,ja as Ke,k as Se,ka as Be,l as P,la as H,m as A,ma as $,n as ve,na as Ye,o as c,p as x,q as B,r as h,s as _,t as a,u as s,v as ye,w as N,x as L,y as S,z as l}from"./chunk-SHQMXKJ2.js";var de="@@STATE",U=(function(e){return e[e.LocalStorage=0]="LocalStorage",e[e.SessionStorage=1]="SessionStorage",e})(U||{}),Q=new k(""),Xe=new k("",{providedIn:"root",factory:()=>y(Q).keys==="*"}),W=new k(""),pe=new k("");function ue(e){return!!e?.engine}function Je(e){return ue(e)&&(e=e.key),F(e,le)&&(e=e[le].name),e instanceof Ie?e.getName():e}function ot(e){return he(K({storage:U.LocalStorage,serialize:JSON.stringify,deserialize:JSON.parse,beforeSerialize:t=>t,afterDeserialize:t=>t},e),{keys:e.keys==="*"?[de]:e.keys})}function it(e){return e.storage===U.LocalStorage?localStorage:e.storage===U.SessionStorage?sessionStorage:null}function He(e,t){return t?.namespace?`${t.namespace}:${e}`:e}var rt=(()=>{class e{_keys=new Set;_injector=y(ve);_keysWithEngines=[];constructor(){let{keys:n}=y(W);this.addKeys(n)}getKeysWithEngines(){return[...this._keysWithEngines]}addKeys(n){for(let o of n){let i=Je(o);if(this._keys.has(i))continue;this._keys.add(i);let r=ue(o)?this._injector.get(o.engine):this._injector.get(pe);this._keysWithEngines.push({key:i,engine:r})}}static \u0275fac=function(o){return new(o||e)};static \u0275prov=I({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),at=(()=>{class e{_keysManager=y(rt);_options=y(W);_allStatesPersisted=y(Xe);handle(n,o,i){let r=Ne(o),u=r(Pe),v=r(Ae),ge=u||v,fe=!1;if(ge){let M=v&&o.addedStates;for(let{key:f,engine:ne}of this._keysManager.getKeysWithEngines()){if(!this._allStatesPersisted&&M){let m=f.indexOf(st),oe=m>-1?f.slice(0,m):f;if(!F(M,oe))continue}let z=He(f,this._options),p=ne.getItem(z);if(p!=="undefined"&&p!=null){try{let m=this._options.deserialize(p);p=this._options.afterDeserialize(m,f)}catch{p={}}this._options.migrations?.forEach(m=>{let oe=m.version===ce(p,m.versionKey||"version"),nt=!m.key&&this._allStatesPersisted||m.key===f;oe&&nt&&(p=m.migrate(p),fe=!0)}),this._allStatesPersisted?(p=this._hydrateSelectivelyOnUpdate(p,M),n=K(K({},n),p)):n=Le(n,f,p)}}}return i(n,o).pipe(O(M=>{if(!(ge&&!fe))for(let{key:f,engine:ne}of this._keysManager.getKeysWithEngines()){let z=M,p=He(f,this._options);f!==de&&(z=ce(M,f));try{let m=this._options.beforeSerialize(z,f);ne.setItem(p,this._options.serialize(m))}catch{}}}))}_hydrateSelectivelyOnUpdate(n,o){return!n||!o||Object.keys(o).length===0?n:Object.keys(o).reduce((i,r)=>(F(n,r)&&(i[r]=n[r]),i),{})}static \u0275fac=function(o){return new(o||e)};static \u0275prov=I({token:e,factory:e.\u0275fac})}return e})(),st=".";function $e(e){return Se([je(at),{provide:Q,useValue:e},{provide:W,useFactory:ot,deps:[Q]},{provide:pe,useFactory:it,deps:[W]}])}var Qe=(()=>{let t=class t{constructor(o){this.payload=o}};t.type="[Auth] Connexion";let e=t;return e})(),Z=(()=>{let t=class t{constructor(o,i){this.email=o,this.password=i}};t.type="[Auth] Login";let e=t;return e})(),q=(()=>{let t=class t{constructor(o,i){this.accessToken=o,this.user=i}};t.type="[Auth] Login Success";let e=t;return e})(),b=(()=>{let t=class t{constructor(o){this.error=o}};t.type="[Auth] Login Failure";let e=t;return e})(),ee=(()=>{let t=class t{};t.type="[Auth] Logout";let e=t;return e})(),te=(()=>{let t=class t{constructor(o,i,r,u){this.login=o,this.password=i,this.firstname=r,this.lastname=u}};t.type="[Auth] Register";let e=t;return e})();function dt(e,t){e&1&&(a(0,"h2"),l(1,"Connexion"),s())}function pt(e,t){e&1&&(a(0,"h2"),l(1,"Cr\xE9er un compte"),s())}function ut(e,t){if(e&1){let n=N();a(0,"div",2)(1,"label"),l(2,"Firstname"),s(),a(3,"input",8),j("ngModelChange",function(i){P(n);let r=S();return G(r.firstname,i)||(r.firstname=i),A(i)}),s()()}if(e&2){let n=S();c(3),R("ngModel",n.firstname)}}function mt(e,t){if(e&1){let n=N();a(0,"div",2)(1,"label"),l(2,"Lastname"),s(),a(3,"input",9),j("ngModelChange",function(i){P(n);let r=S();return G(r.lastname,i)||(r.lastname=i),A(i)}),s()()}if(e&2){let n=S();c(3),R("ngModel",n.lastname)}}function gt(e,t){if(e&1&&(a(0,"div",5),l(1),s()),e&2){let n=S();c(),D(n.error)}}var Ze=(()=>{let t=class t{constructor(o,i){this.store=o,this.router=i,this.firstname="",this.lastname="",this.login="",this.password="",this.error="",this.signupMode=!1}submit(){this.error="",this.signupMode?this.store.dispatch(new te(this.login,this.password,this.firstname,this.lastname)).subscribe({next:()=>{localStorage.getItem("accessToken")?this.router.navigate(["/pollution/list"]):this.error="Impossible de cr\xE9er le compte (login peut exister)"},error:o=>{this.error="Erreur lors de l'inscription"}}):this.store.dispatch(new Z(this.login,this.password)).subscribe({next:()=>{localStorage.getItem("accessToken")?this.router.navigate(["/pollution/list"]):this.error="Identifiants invalides"},error:o=>{this.error="Erreur de connexion"}})}toggleSignup(){this.signupMode=!this.signupMode,this.error=""}};t.\u0275fac=function(i){return new(i||t)(x(T),x(X))},t.\u0275cmp=B({type:t,selectors:[["app-login"]],decls:19,vars:8,consts:[[1,"login-container"],[3,"ngSubmit"],[1,"form-group"],["name","login",1,"form-control",3,"ngModelChange","ngModel"],["type","password","name","password",1,"form-control",3,"ngModelChange","ngModel"],[1,"error"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-link",3,"click"],["name","firstname",1,"form-control",3,"ngModelChange","ngModel"],["name","lastname",1,"form-control",3,"ngModelChange","ngModel"]],template:function(i,r){i&1&&(a(0,"div",0),h(1,dt,2,0,"h2"),h(2,pt,2,0,"h2"),a(3,"form",1),L("ngSubmit",function(){return r.submit()}),h(4,ut,4,1,"div",2),h(5,mt,4,1,"div",2),a(6,"div",2)(7,"label"),l(8,"Login"),s(),a(9,"input",3),j("ngModelChange",function(v){return G(r.login,v)||(r.login=v),v}),s()(),a(10,"div",2)(11,"label"),l(12,"Mot de passe"),s(),a(13,"input",4),j("ngModelChange",function(v){return G(r.password,v)||(r.password=v),v}),s()(),h(14,gt,2,1,"div",5),a(15,"button",6),l(16),s(),a(17,"button",7),L("click",function(){return r.toggleSignup()}),l(18," {{ signupMode ? 'J'ai d\xE9j\xE0 un compte' : 'Cr\xE9er un compte' }} "),s()()()),i&2&&(c(),_(r.signupMode?-1:1),c(),_(r.signupMode?2:-1),c(2),_(r.signupMode?4:-1),c(),_(r.signupMode?5:-1),c(4),R("ngModel",r.login),c(4),R("ngModel",r.password),c(),_(r.error?14:-1),c(2),Ce(" ",r.signupMode?"Cr\xE9er le compte":"Se connecter"," "))},dependencies:[Y,Be,Ke,Fe,Ue,We,ze,Ve],styles:[".login-container[_ngcontent-%COMP%]{max-width:420px;margin:24px auto;padding:16px;background:#fff;border-radius:8px;box-shadow:0 2px 8px #00000014}.form-group[_ngcontent-%COMP%]{margin-bottom:12px}.form-control[_ngcontent-%COMP%]{width:100%;padding:8px}.error[_ngcontent-%COMP%]{color:#b00020;margin-bottom:8px}"]});let e=t;return e})();var qe=[{path:"login",component:Ze},{path:"",redirectTo:"/pollution/list",pathMatch:"full"},{path:"pollution",loadChildren:()=>import("./chunk-NY6KN4BY.js").then(e=>e.PollutionModule)},{path:"**",redirectTo:"/pollution/list"}];var C,d=(C=class{constructor(t){this.authService=t}static isConnected(t){return t.connexion}static getAccessToken(t){return t.accessToken}static getUser(t){return t.user}add({getState:t,patchState:n},{payload:o}){n({connexion:o.connexion})}login({dispatch:t},{email:n,password:o}){return this.authService.login(n,o).pipe(O(i=>{t(i?new q(i.accessToken,i.user):new b("Invalid credentials"))}),re(i=>(t(new b(i.message||"Login failed")),ie(null))))}loginSuccess({patchState:t},{accessToken:n,user:o}){localStorage.setItem("accessToken",n),localStorage.setItem("currentUser",JSON.stringify(o)),t({connexion:!0,accessToken:n,user:o})}loginFailure({patchState:t},{error:n}){console.error("Login failed:",n)}logout({patchState:t}){localStorage.removeItem("accessToken"),localStorage.removeItem("currentUser"),t({connexion:!1,accessToken:null,user:null})}register({dispatch:t},{login:n,password:o,firstname:i,lastname:r}){return this.authService.register(n,o,i,r).pipe(O(u=>{t(u?new q(u.accessToken,u.user):new b("Registration failed"))}),re(u=>(t(new b(u.message||"Registration failed")),ie(null))))}},C.\u0275fac=function(n){return new(n||C)(_e($))},C.\u0275prov=I({token:C,factory:C.\u0275fac}),C);g([E(Qe)],d.prototype,"add",null);g([E(Z)],d.prototype,"login",null);g([E(q)],d.prototype,"loginSuccess",null);g([E(b)],d.prototype,"loginFailure",null);g([E(ee)],d.prototype,"logout",null);g([E(te)],d.prototype,"register",null);g([J()],d,"isConnected",null);g([J()],d,"getAccessToken",null);g([J()],d,"getUser",null);d=g([De({name:"auth",defaults:{connexion:!1,accessToken:null,user:null}})],d);var et=(e,t)=>{let o=y(T).selectSnapshot(d.getAccessToken);return o&&(e=e.clone({setHeaders:{Authorization:`Bearer ${o}`}})),t(e)};var tt={providers:[Oe(qe),Me(ke([et])),Ge([H,d],$e({keys:["favorites","auth"]}))]};function ht(e,t){if(e&1&&(a(0,"span",11),l(1),ae(2,"async"),s()),e&2){let n=S(2);c(),D(se(2,1,n.favoritesCount$))}}function _t(e,t){if(e&1&&(a(0,"a",6),l(1," \u{1F499} Favoris "),h(2,ht,3,3,"span",11),ae(3,"async"),s()),e&2){let n=S();c(2),_(se(3,1,n.favoritesCount$)>0?2:-1)}}function St(e,t){e&1&&(a(0,"a",7),l(1," \u{1F510} Connexion "),s())}function vt(e,t){if(e&1){let n=N();a(0,"div",8)(1,"span"),l(2),s(),a(3,"button",12),L("click",function(){P(n);let i=S();return A(i.logout())}),l(4,"Se d\xE9connecter"),s()()}if(e&2){let n=S();c(2),D(n.userName)}}var w=class w{constructor(t,n,o){this.auth=t,this.store=n,this.router=o,this.title="Pollution Tracker",this.userName=""}ngOnInit(){this.auth.getCurrentUser().subscribe(t=>{this.userName=t?`${t.firstname} ${t.lastname}`:""})}logout(){this.store.dispatch(new ee),this.router.navigate(["/login"])}};w.\u0275fac=function(n){return new(n||w)(x($),x(T),x(X))},w.\u0275cmp=B({type:w,selectors:[["app-root"]],decls:18,vars:3,consts:[[1,"app-container"],[1,"navbar"],[1,"navbar-brand"],[1,"navbar-menu"],["routerLink","/pollution/list","routerLinkActive","active",1,"nav-link"],["routerLink","/pollution/report","routerLinkActive","active",1,"nav-link"],["routerLink","/pollution/favorites","routerLinkActive","active",1,"nav-link","favorites-link"],["routerLink","/login","routerLinkActive","active",1,"nav-link"],[1,"nav-user"],[1,"main-content"],[1,"footer"],[1,"badge"],[1,"btn","btn-link",3,"click"]],template:function(n,o){n&1&&(a(0,"div",0)(1,"nav",1)(2,"div",2)(3,"h1"),l(4,"\u{1F30D} Pollution Tracker"),s()(),a(5,"div",3)(6,"a",4),l(7," \u{1F4CB} Liste des pollutions "),s(),a(8,"a",5),l(9," \u2795 Signaler une pollution "),s(),h(10,_t,4,3,"a",6),h(11,St,2,0,"a",7),h(12,vt,5,1,"div",8),s()(),a(13,"main",9),ye(14,"router-outlet"),s(),a(15,"footer",10)(16,"p"),l(17," \xA9 2025 Pollution Tracker - Application de signalement de pollutions "),s()()()),n&2&&(c(10),_(o.userName?10:-1),c(),_(o.userName?-1:11),c(),_(o.userName?12:-1))},dependencies:[Y,Te,be,we,Ye,xe],styles:["*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box}.app-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column;background-color:#f5f6fa}.navbar[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:.9375rem 1.875rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 .25rem .75rem #00000026}.navbar-brand[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;margin:0}.navbar-menu[_ngcontent-%COMP%]{display:flex;gap:1.25rem}.nav-link[_ngcontent-%COMP%]{color:#fff;text-decoration:none;padding:.625rem 1.25rem;border-radius:.375rem;font-weight:500;transition:all .3s;background:#ffffff1a}.nav-link[_ngcontent-%COMP%]:hover{background:#fff3;transform:translateY(-.125rem)}.nav-link.active[_ngcontent-%COMP%]{background:#ffffff4d;font-weight:700}.favorites-link[_ngcontent-%COMP%]{position:relative}.badge[_ngcontent-%COMP%]{position:absolute;top:-.375rem;right:-.375rem;background:#dc3545;color:#fff;border-radius:50%;padding:.15rem .5rem;font-size:.75rem;font-weight:700;min-width:1.25rem;text-align:center;box-shadow:0 .125rem .25rem #0003}.nav-user[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.625rem;color:#fff}.btn-link[_ngcontent-%COMP%]{background:none;border:none;color:#fff;cursor:pointer;text-decoration:underline;font-size:.875rem}.btn-link[_ngcontent-%COMP%]:hover{color:#f0f0f0}.main-content[_ngcontent-%COMP%]{flex:1;padding:1.25rem;max-width:100%}.footer[_ngcontent-%COMP%]{background:#2c3e50;color:#fff;text-align:center;padding:1.25rem;margin-top:auto}.footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.9rem}@media (max-width: 48rem){.navbar[_ngcontent-%COMP%]{flex-direction:column;gap:.9375rem;padding:.9375rem 1.25rem}.navbar-brand[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.navbar-menu[_ngcontent-%COMP%]{width:100%;flex-direction:column;gap:.625rem}.nav-link[_ngcontent-%COMP%]{text-align:center}.main-content[_ngcontent-%COMP%]{padding:.625rem}}"]});var V=w;g([Re(H.getFavoritesCount)],V.prototype,"favoritesCount$",void 0);Ee(V,tt).catch(e=>console.error(e));
